<Window x:Class="TaxiGO.DispatcherWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
        xmlns:local="clr-namespace:TaxiGO"
        Title="TaxiGO - Диспетчер" 
        Height="600" 
        MinHeight="500"
        Width="1000" 
        MinWidth="800"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None" 
        AllowsTransparency="True" 
        Background="Transparent">
    <Window.Resources>
        <!-- Конвертеры -->
        <local:StatusToVisibilityConverter x:Key="StatusToVisibilityConverter"/>
        <local:NullToTextConverter x:Key="NullToTextConverter"/>
        <local:BooleanToTextConverter x:Key="BooleanToTextConverter" TrueText="Оплачено" FalseText="Не оплачено"/>
        <local:OrderStatusToColorConverter x:Key="StatusToColorConverter"/>

        <!-- Анимации для переходов -->
        <Storyboard x:Key="SlideOutLeftAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="1" To="0.2" Duration="0:0:0.3"/>
            <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.X)" From="0" To="-50" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        <Storyboard x:Key="SlideInRightAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.3"/>
            <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.X)" From="50" To="0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        <Storyboard x:Key="ShakeAnimation">
            <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.X)"
                           From="0" To="5" Duration="0:0:0.05" AutoReverse="True" RepeatBehavior="3x">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseInOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Стиль для боковой панели -->
        <Style x:Key="SidebarStyle" TargetType="Border">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="#FF1E1E1E" Offset="0"/>
                        <GradientStop Color="#FF2E2E2E" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Visibility" Value="Visible"/>
        </Style>

        <!-- Стиль для кнопок навигации -->
        <Style x:Key="NavButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#FFD1D1D1"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="10,5"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="ToolTipService.InitialShowDelay" Value="500"/>
            <Setter Property="ToolTipService.ShowDuration" Value="5000"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" Background="{TemplateBinding Background}" CornerRadius="25">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FF3A3A3A" Offset="0"/>
                                            <GradientStop Color="#FF4A4A4A" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter TargetName="Border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#FF42A5F5" BlurRadius="15" ShadowDepth="0" Opacity="0.7"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="Border" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.05" ScaleY="1.05" CenterX="25" CenterY="25"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FF2A2A2A" Offset="0"/>
                                            <GradientStop Color="#FF3A3A3A" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="Tag" Value="Active">
                                <Setter TargetName="Border" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FF42A5F5" Offset="0"/>
                                            <GradientStop Color="#FF7C4DFF" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для кнопки "Выйти" -->
        <Style x:Key="LogoutButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#FFFF6B6B"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="10,5"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="ToolTipService.InitialShowDelay" Value="500"/>
            <Setter Property="ToolTipService.ShowDuration" Value="5000"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" Background="{TemplateBinding Background}" CornerRadius="25" BorderBrush="#FFFF6B6B" BorderThickness="2">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FFFF6B6B"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter TargetName="Border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#FFFF6B6B" BlurRadius="15" ShadowDepth="0" Opacity="0.7"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="Border" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.05" ScaleY="1.05" CenterX="25" CenterY="25"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FFCC5252"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для кнопок управления окном -->
        <Style x:Key="WindowControlButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FF3A3A3A"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FF4A4A4A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для кнопки закрытия -->
        <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource WindowControlButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FF8B0000"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FF4A4A4A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для основных кнопок -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#FF42A5F5"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Margin" Value="10,5"/>
            <Setter Property="Width" Value="150"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" Background="{TemplateBinding Background}" CornerRadius="20" BorderBrush="#FF42A5F5" BorderThickness="2">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FF42A5F5" Offset="0"/>
                                            <GradientStop Color="#FF7C4DFF" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter TargetName="Border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#FF42A5F5" BlurRadius="15" ShadowDepth="0" Opacity="0.7"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="Border" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.05" ScaleY="1.05" CenterX="75" CenterY="20"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FF3A8FD1" Offset="0"/>
                                            <GradientStop Color="#FF673AB7" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="Tag" Value="Cancel">
                                <Setter Property="Foreground" Value="#FFF44336"/>
                                <Setter TargetName="Border" Property="BorderBrush" Value="#FFF44336"/>
                                <Setter TargetName="Border" Property="Background" Value="Transparent"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="Tag" Value="Cancel"/>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Border" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FFF44336" Offset="0"/>
                                            <GradientStop Color="#FFD81B60" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter TargetName="Border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#FFF44336" BlurRadius="15" ShadowDepth="0" Opacity="0.7"/>
                                    </Setter.Value>
                                </Setter>
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для карточек заказов -->
        <Style x:Key="OrderCardStyle" TargetType="Border">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#FF1C2526" Offset="0"/>
                        <GradientStop Color="#FF2A3435" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush" Value="#FF424242"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="20"/>
            <Setter Property="Margin" Value="20,15"/>
            <Setter Property="Padding" Value="25"/>
            <Setter Property="Width" Value="600"/>
            <Setter Property="MaxWidth" Value="800"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#FF000000" BlurRadius="20" ShadowDepth="3" Opacity="0.5"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="#FF42A5F5" BlurRadius="25" ShadowDepth="5" Opacity="0.7"/>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <TranslateTransform Y="-5"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <DataTrigger Binding="{Binding Status}" Value="Completed">
                    <Setter Property="BorderBrush" Value="#FF4CAF50"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Pending">
                    <Setter Property="BorderBrush" Value="#FFFFC107"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Canceled">
                    <Setter Property="BorderBrush" Value="#FFF44336"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Accepted">
                    <Setter Property="BorderBrush" Value="#FF2196F3"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                    <Setter Property="Width" Value="900"/>
                    <Setter Property="MaxWidth" Value="1000"/>
                    <Setter Property="Margin" Value="30,20"/>
                    <Setter Property="Padding" Value="35"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Стиль для TextBlock в карточках заказов -->
        <Style x:Key="OrderCardTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#FFB0B0B0"/>
            <Setter Property="Margin" Value="0,3,0,3"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                    <Setter Property="FontSize" Value="16"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Стиль для ComboBox -->
        <Style x:Key="CustomComboBoxStyle" TargetType="ComboBox" BasedOn="{StaticResource MaterialDesignFloatingHintComboBox}">
            <Setter Property="Height" Value="56"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Foreground" Value="#FFFFFFFF"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="BorderBrush" Value="#FF888888"/>
            <Setter Property="Background" Value="#FF2E2E2E"/>
            <Setter Property="Padding" Value="0,0,10,0"/>
            <Setter Property="materialDesign:HintAssist.Foreground" Value="#FF888888"/>
            <Setter Property="materialDesign:HintAssist.FloatingOffset" Value="0,-20"/>
            <Setter Property="materialDesign:ComboBoxAssist.ShowSelectedItem" Value="True"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#FF42A5F5"/>
                    <Setter Property="BorderThickness" Value="0,0,0,3"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="#FF42A5F5"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Стиль для TextBox -->
        <Style x:Key="SearchTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignFloatingHintTextBox}">
            <Setter Property="Height" Value="56"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Foreground" Value="#FFFFFFFF"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="BorderBrush" Value="#FF888888"/>
            <Setter Property="Background" Value="#FF2E2E2E"/>
            <Setter Property="Padding" Value="10,0,10,0"/>
            <Setter Property="materialDesign:HintAssist.Foreground" Value="#FF888888"/>
            <Setter Property="materialDesign:HintAssist.FloatingOffset" Value="0,-20"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#FF42A5F5"/>
                    <Setter Property="BorderThickness" Value="0,0,0,3"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="#FF42A5F5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <!-- Основная разметка окна -->
    <Grid x:Name="MainGrid">
        <Grid.Clip>
            <RectangleGeometry RadiusX="20" RadiusY="20"/>
        </Grid.Clip>
        <Border x:Name="MainBorder" CornerRadius="20">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#FF1E1E1E" Offset="0"/>
                    <GradientStop Color="#FF2E2E2E" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition x:Name="SidebarColumn" Width="80"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Боковая панель -->
                <Border Style="{StaticResource SidebarStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <!-- Заголовок -->
                        <TextBlock Text="TaxiGO" Foreground="#FFE0E0E0" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,20,0,20"/>
                        <!-- Кнопки навигации -->
                        <Grid Grid.Row="1">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Button x:Name="AssignOrdersNavButton" Grid.Row="0" Tag="Active" Click="NavButton_Click" Style="{StaticResource NavButtonStyle}" ToolTip="Назначить заказы">
                                <materialDesign:PackIcon Kind="ClipboardCheck" Width="24" Height="24"/>
                            </Button>
                            <Button x:Name="ActiveOrdersNavButton" Grid.Row="1" Click="NavButton_Click" Style="{StaticResource NavButtonStyle}" ToolTip="Активные заказы">
                                <materialDesign:PackIcon Kind="Car" Width="24" Height="24"/>
                            </Button>
                            <Button x:Name="StatisticsNavButton" Grid.Row="2" Click="NavButton_Click" Style="{StaticResource NavButtonStyle}" ToolTip="Статистика">
                                <materialDesign:PackIcon Kind="ChartBar" Width="24" Height="24"/>
                            </Button>
                        </Grid>
                        <!-- Кнопка выхода -->
                        <Button Grid.Row="2" Style="{StaticResource LogoutButtonStyle}" Click="LogoutButton_Click" ToolTip="Выйти">
                            <materialDesign:PackIcon Kind="Logout" Width="24" Height="24"/>
                        </Button>
                    </Grid>
                </Border>

                <!-- Основное содержимое -->
                <Grid Grid.Column="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Grid.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#FF2A2A2A" Offset="0"/>
                            <GradientStop Color="#FF424242" Offset="1"/>
                        </LinearGradientBrush>
                    </Grid.Background>

                    <!-- Панель заголовка -->
                    <Border Background="#FF252525" BorderBrush="#FF42A5F5" BorderThickness="0,0,0,1" MouseDown="TitleBar_MouseDown">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <!-- Заголовок -->
                            <TextBlock x:Name="WelcomeText" Text="Назначить заказы" Foreground="#FFE0E0E0" FontSize="20" FontWeight="Bold" Margin="20,10" VerticalAlignment="Center"/>
                            <!-- Кнопки управления окном -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button x:Name="MinimizeButton" Click="MinimizeButton_Click" Style="{StaticResource WindowControlButtonStyle}">
                                    <materialDesign:PackIcon Kind="WindowMinimize" Foreground="#FFD1D1D1" Width="16" Height="16"/>
                                </Button>
                                <Button x:Name="MaximizeRestoreButton" Click="MaximizeRestoreButton_Click" Style="{StaticResource WindowControlButtonStyle}">
                                    <materialDesign:PackIcon x:Name="MaximizeRestoreIcon" Kind="WindowMaximize" Foreground="#FFD1D1D1" Width="16" Height="16"/>
                                </Button>
                                <Button x:Name="CloseButton" Click="CloseButton_Click" Style="{StaticResource CloseButtonStyle}">
                                    <materialDesign:PackIcon Kind="Close" Foreground="#FFD1D1D1" Width="16" Height="16"/>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Содержимое -->
                    <Grid Grid.Row="1" Margin="20">
                        <!-- Вкладка "Назначить заказы" -->
                        <Grid x:Name="AssignOrdersPanel" Opacity="1" Visibility="Visible">
                            <Grid.RenderTransform>
                                <TranslateTransform X="0"/>
                            </Grid.RenderTransform>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <!-- Панель поиска и фильтров -->
                            <Border Background="#FF2E2E2E" CornerRadius="10" Margin="0,0,0,10" Padding="10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="2*"/>
                                        <ColumnDefinition Width="1*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox x:Name="SearchTextBox" 
                                             Grid.Column="0" 
                                             Margin="0,0,10,0" 
                                             Style="{StaticResource SearchTextBoxStyle}"
                                             materialDesign:HintAssist.Hint="Поиск по ID, клиенту, адресу"
                                             TextChanged="SearchTextBox_TextChanged"/>
                                    <ComboBox x:Name="StatusFilterComboBox" 
                                              Grid.Column="1" 
                                              Margin="10,0,10,0" 
                                              Style="{StaticResource CustomComboBoxStyle}"
                                              materialDesign:HintAssist.Hint="Фильтр по статусу"
                                              SelectionChanged="StatusFilterComboBox_SelectionChanged"/>
                                    <Button x:Name="RefreshButton" 
                                            Grid.Column="2" 
                                            Content="Обновить" 
                                            Click="RefreshButton_Click" 
                                            Style="{StaticResource ActionButtonStyle}"/>
                                </Grid>
                            </Border>
                            <!-- Список заказов -->
                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <ItemsControl x:Name="PendingOrdersList" 
                                                  VirtualizingStackPanel.IsVirtualizing="True"
                                                  VirtualizingStackPanel.VirtualizationMode="Recycling">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Style="{StaticResource OrderCardStyle}">
                                                    <Border.RenderTransform>
                                                        <TranslateTransform X="0" Y="0"/>
                                                    </Border.RenderTransform>
                                                    <Border.Triggers>
                                                        <EventTrigger RoutedEvent="Loaded">
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.4"/>
                                                                    <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.X)" 
                                                                                    From="30" To="0" Duration="0:0:0.4">
                                                                        <DoubleAnimation.EasingFunction>
                                                                            <SineEase EasingMode="EaseOut"/>
                                                                        </DoubleAnimation.EasingFunction>
                                                                    </DoubleAnimation>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </EventTrigger>
                                                        <EventTrigger RoutedEvent="MouseEnter">
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.Y)" 
                                                                                    From="0" To="-5" Duration="0:0:0.2">
                                                                        <DoubleAnimation.EasingFunction>
                                                                            <SineEase EasingMode="EaseOut"/>
                                                                        </DoubleAnimation.EasingFunction>
                                                                    </DoubleAnimation>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </EventTrigger>
                                                        <EventTrigger RoutedEvent="MouseLeave">
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.Y)" 
                                                                                    From="-5" To="0" Duration="0:0:0.2">
                                                                        <DoubleAnimation.EasingFunction>
                                                                            <SineEase EasingMode="EaseIn"/>
                                                                        </DoubleAnimation.EasingFunction>
                                                                    </DoubleAnimation>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </EventTrigger>
                                                    </Border.Triggers>
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>
                                                        <!-- Заголовок и статус -->
                                                        <Grid Grid.Row="0" Margin="0,0,0,20">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <materialDesign:PackIcon Kind="Taxi" Width="28" Height="28" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,12,0"/>
                                                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                                                <TextBlock Text="{Binding OrderId, StringFormat=Заказ #{0}}" FontSize="18" FontWeight="Bold" Foreground="#FFE0E0E0"/>
                                                                <Border Margin="12,0,0,0" Padding="10,3" CornerRadius="8">
                                                                    <Border.Background>
                                                                        <MultiBinding Converter="{StaticResource StatusToColorConverter}">
                                                                            <Binding Path="Status"/>
                                                                        </MultiBinding>
                                                                    </Border.Background>
                                                                    <TextBlock FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Foreground" Value="White"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding Status}" Value="Pending">
                                                                                        <Setter Property="Text" Value="В ожидании"/>
                                                                                        <Setter Property="Foreground" Value="#FF333333"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding Status}" Value="Accepted">
                                                                                        <Setter Property="Text" Value="Принят"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding Status}" Value="Completed">
                                                                                        <Setter Property="Text" Value="Завершён"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding Status}" Value="Canceled">
                                                                                        <Setter Property="Text" Value="Отменён"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                </Border>
                                                            </StackPanel>
                                                            <TextBlock Grid.Column="2" Text="{Binding OrderTime, StringFormat={}{0:dd.MM.yyyy HH:mm}}" FontSize="16" Foreground="#FFB0B0B0" VerticalAlignment="Center"/>
                                                        </Grid>
                                                        <!-- Основная информация -->
                                                        <Grid Grid.Row="1" Margin="0,0,0,20">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>
                                                            <!-- Левая колонка -->
                                                            <StackPanel Grid.Column="0" Margin="0,0,20,0">
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="MapMarker" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding StartPoint, StringFormat=От: {0}}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="MapMarkerCheck" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding EndPoint, StringFormat=До: {0}}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="Car" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding Tariff.Name, StringFormat=Тариф: {0}}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="Account" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding Client.Name, StringFormat=Клиент: {0}}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                            </StackPanel>
                                                            <!-- Правая колонка -->
                                                            <StackPanel Grid.Column="1">
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="Ruler" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding DistanceKm, StringFormat=Расстояние: {0:F2} км, Converter={StaticResource NullToTextConverter}, ConverterParameter='Не указано'}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="CurrencyRub" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding Cost, StringFormat=Стоимость: {0:F2} ₽, Converter={StaticResource NullToTextConverter}, ConverterParameter='Не рассчитано'}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="CreditCard" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Style="{StaticResource OrderCardTextStyle}">
                                                                        <TextBlock.Text>
                                                                            <MultiBinding StringFormat="Статус оплаты: {0}">
                                                                                <Binding Path="IsPaid" Converter="{StaticResource BooleanToTextConverter}"/>
                                                                            </MultiBinding>
                                                                        </TextBlock.Text>
                                                                    </TextBlock>
                                                                </Grid>
                                                            </StackPanel>
                                                        </Grid>
                                                        <!-- Прогресс заказа -->
                                                        <Grid Grid.Row="2" Margin="0,0,0,20" Visibility="{Binding Status, Converter={StaticResource StatusToVisibilityConverter}, ConverterParameter='Pending|Accepted'}">
                                                            <ProgressBar Value="{Binding Progress}" 
                                                                         Maximum="100" 
                                                                         Height="8" 
                                                                         Background="#FF424242" 
                                                                         Foreground="#FF42A5F5"/>
                                                        </Grid>
                                                        <!-- Кнопки и выбор водителя -->
                                                        <Grid Grid.Row="3" Margin="0,0,0,20">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <ComboBox x:Name="DriverComboBox" 
                                                                      Grid.Column="0" 
                                                                      Width="200" 
                                                                      Margin="0,0,10,0" 
                                                                      Style="{StaticResource CustomComboBoxStyle}"
                                                                      materialDesign:HintAssist.Hint="Выберите водителя"
                                                                      ItemsSource="{Binding AvailableDrivers}"
                                                                      DisplayMemberPath="DisplayName"
                                                                      SelectedValuePath="UserId"
                                                                      Tag="{Binding OrderId}">
                                                                <ComboBox.Triggers>
                                                                    <EventTrigger RoutedEvent="Loaded">
                                                                        <BeginStoryboard>
                                                                            <Storyboard>
                                                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.5"/>
                                                                                <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.Y)" 
                                                                                                From="20" To="0" Duration="0:0:0.5">
                                                                                    <DoubleAnimation.EasingFunction>
                                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                                    </DoubleAnimation.EasingFunction>
                                                                                </DoubleAnimation>
                                                                            </Storyboard>
                                                                        </BeginStoryboard>
                                                                    </EventTrigger>
                                                                </ComboBox.Triggers>
                                                                <ComboBox.RenderTransform>
                                                                    <TranslateTransform Y="0"/>
                                                                </ComboBox.RenderTransform>
                                                            </ComboBox>
                                                            <Button Grid.Column="1" 
                                                                    Content="Назначить" 
                                                                    Click="AssignOrder_Click" 
                                                                    Tag="{Binding OrderId}" 
                                                                    Style="{StaticResource ActionButtonStyle}"/>
                                                            <Button Grid.Column="2" 
                                                                    Content="Отменить" 
                                                                    Click="CancelOrder_Click" 
                                                                    Style="{StaticResource ActionButtonStyle}"
                                                                    Visibility="{Binding Status, Converter={StaticResource StatusToVisibilityConverter}, ConverterParameter='Pending'}"
                                                                    Tag="Cancel"/>
                                                        </Grid>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </ScrollViewer>
                        </Grid>

                        <!-- Вкладка "Активные заказы" -->
                        <Grid x:Name="ActiveOrdersPanel" Opacity="0" Visibility="Hidden">
                            <Grid.RenderTransform>
                                <TranslateTransform X="0"/>
                            </Grid.RenderTransform>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <!-- Панель поиска и фильтров -->
                            <Border Background="#FF2E2E2E" CornerRadius="10" Margin="0,0,0,10" Padding="10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="2*"/>
                                        <ColumnDefinition Width="1*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox x:Name="ActiveSearchTextBox" 
                                             Grid.Column="0" 
                                             Margin="0,0,10,0" 
                                             Style="{StaticResource SearchTextBoxStyle}"
                                             materialDesign:HintAssist.Hint="Поиск по ID, клиенту, адресу"
                                             TextChanged="SearchTextBox_TextChanged"/>
                                    <ComboBox x:Name="ActiveStatusFilterComboBox" 
                                              Grid.Column="1" 
                                              Margin="10,0,10,0" 
                                              Style="{StaticResource CustomComboBoxStyle}"
                                              materialDesign:HintAssist.Hint="Фильтр по статусу"
                                              SelectionChanged="StatusFilterComboBox_SelectionChanged"/>
                                    <Button x:Name="ActiveRefreshButton" 
                                            Grid.Column="2" 
                                            Content="Обновить" 
                                            Click="RefreshButton_Click" 
                                            Style="{StaticResource ActionButtonStyle}"/>
                                </Grid>
                            </Border>
                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <ItemsControl x:Name="ActiveOrdersList" 
                                                  VirtualizingStackPanel.IsVirtualizing="True"
                                                  VirtualizingStackPanel.VirtualizationMode="Recycling">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Style="{StaticResource OrderCardStyle}">
                                                    <Border.RenderTransform>
                                                        <TranslateTransform X="0" Y="0"/>
                                                    </Border.RenderTransform>
                                                    <Border.Triggers>
                                                        <EventTrigger RoutedEvent="Loaded">
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.4"/>
                                                                    <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.X)" 
                                                                                    From="30" To="0" Duration="0:0:0.4">
                                                                        <DoubleAnimation.EasingFunction>
                                                                            <SineEase EasingMode="EaseOut"/>
                                                                        </DoubleAnimation.EasingFunction>
                                                                    </DoubleAnimation>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </EventTrigger>
                                                        <EventTrigger RoutedEvent="MouseEnter">
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.Y)" 
                                                                                    From="0" To="-5" Duration="0:0:0.2">
                                                                        <DoubleAnimation.EasingFunction>
                                                                            <SineEase EasingMode="EaseOut"/>
                                                                        </DoubleAnimation.EasingFunction>
                                                                    </DoubleAnimation>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </EventTrigger>
                                                        <EventTrigger RoutedEvent="MouseLeave">
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.Y)" 
                                                                                    From="-5" To="0" Duration="0:0:0.2">
                                                                        <DoubleAnimation.EasingFunction>
                                                                            <SineEase EasingMode="EaseIn"/>
                                                                        </DoubleAnimation.EasingFunction>
                                                                    </DoubleAnimation>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </EventTrigger>
                                                    </Border.Triggers>
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>
                                                        <!-- Заголовок и статус -->
                                                        <Grid Grid.Row="0" Margin="0,0,0,20">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <materialDesign:PackIcon Kind="Taxi" Width="28" Height="28" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,12,0"/>
                                                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                                                <TextBlock Text="{Binding OrderId, StringFormat=Заказ #{0}}" FontSize="18" FontWeight="Bold" Foreground="#FFE0E0E0"/>
                                                                <Border Margin="12,0,0,0" Padding="10,3" CornerRadius="8">
                                                                    <Border.Background>
                                                                        <MultiBinding Converter="{StaticResource StatusToColorConverter}">
                                                                            <Binding Path="Status"/>
                                                                        </MultiBinding>
                                                                    </Border.Background>
                                                                    <TextBlock FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Foreground" Value="White"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding Status}" Value="Completed">
                                                                                        <Setter Property="Text" Value="Завершён"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding Status}" Value="Pending">
                                                                                        <Setter Property="Text" Value="В ожидании"/>
                                                                                        <Setter Property="Foreground" Value="#FF333333"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding Status}" Value="Canceled">
                                                                                        <Setter Property="Text" Value="Отменён"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding Status}" Value="Accepted">
                                                                                        <Setter Property="Text" Value="Принят"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                </Border>
                                                            </StackPanel>
                                                            <TextBlock Grid.Column="2" Text="{Binding OrderTime, StringFormat={}{0:dd.MM.yyyy HH:mm}}" FontSize="16" Foreground="#FFB0B0B0" VerticalAlignment="Center"/>
                                                        </Grid>
                                                        <!-- Основная информация -->
                                                        <Grid Grid.Row="1" Margin="0,0,0,20">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>
                                                            <!-- Левая колонка -->
                                                            <StackPanel Grid.Column="0" Margin="0,0,20,0">
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="MapMarker" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding StartPoint, StringFormat=От: {0}}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="MapMarkerCheck" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding EndPoint, StringFormat=До: {0}}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="Car" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding Tariff.Name, StringFormat=Тариф: {0}}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="Account" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding Client.Name, StringFormat=Клиент: {0}}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                            </StackPanel>
                                                            <!-- Правая колонка -->
                                                            <StackPanel Grid.Column="1">
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="Account" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding Driver.Name, StringFormat=Водитель: {0}, Converter={StaticResource NullToTextConverter}, ConverterParameter='Не назначен'}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="Ruler" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding DistanceKm, StringFormat=Расстояние: {0:F2} км, Converter={StaticResource NullToTextConverter}, ConverterParameter='Не указано'}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="CurrencyRub" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Text="{Binding Cost, StringFormat=Стоимость: {0:F2} ₽, Converter={StaticResource NullToTextConverter}, ConverterParameter='Не рассчитано'}" Style="{StaticResource OrderCardTextStyle}"/>
                                                                </Grid>
                                                                <Grid Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <materialDesign:PackIcon Kind="CreditCard" Width="20" Height="20" Foreground="#FF42A5F5" VerticalAlignment="Center" Margin="0,0,10,0">
                                                                        <materialDesign:PackIcon.Style>
                                                                            <Style TargetType="materialDesign:PackIcon">
                                                                                <Setter Property="Width" Value="20"/>
                                                                                <Setter Property="Height" Value="20"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                                                                                        <Setter Property="Width" Value="24"/>
                                                                                        <Setter Property="Height" Value="24"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </materialDesign:PackIcon.Style>
                                                                    </materialDesign:PackIcon>
                                                                    <TextBlock Grid.Column="1" Style="{StaticResource OrderCardTextStyle}">
                                                                        <TextBlock.Text>
                                                                            <MultiBinding StringFormat="Статус оплаты: {0}">
                                                                                <Binding Path="IsPaid" Converter="{StaticResource BooleanToTextConverter}"/>
                                                                            </MultiBinding>
                                                                        </TextBlock.Text>
                                                                    </TextBlock>
                                                                </Grid>
                                                            </StackPanel>
                                                        </Grid>
                                                        <!-- Прогресс заказа -->
                                                        <Grid Grid.Row="2" Margin="0,0,0,20" Visibility="{Binding Status, Converter={StaticResource StatusToVisibilityConverter}, ConverterParameter='Accepted'}">
                                                            <ProgressBar Value="{Binding Progress}" 
                                                                         Maximum="100" 
                                                                         Height="8" 
                                                                         Background="#FF424242" 
                                                                         Foreground="#FF42A5F5"/>
                                                        </Grid>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </ScrollViewer>
                        </Grid>

                        <!-- Вкладка "Статистика" -->
                        <Grid x:Name="StatisticsPanel" Opacity="0" Visibility="Hidden">
                            <Grid.RenderTransform>
                                <TranslateTransform X="0"/>
                            </Grid.RenderTransform>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <!-- Панель фильтров -->
                            <Border Background="#FF2E2E2E" CornerRadius="10" Margin="0,0,0,10" Padding="10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ComboBox x:Name="StatisticsPeriodComboBox" 
                                              Grid.Column="0" 
                                              Margin="0,0,10,0" 
                                              Style="{StaticResource CustomComboBoxStyle}"
                                              materialDesign:HintAssist.Hint="Период"
                                              SelectionChanged="StatisticsPeriodComboBox_SelectionChanged">
                                        <ComboBoxItem Content="Сегодня"/>
                                        <ComboBoxItem Content="Неделя"/>
                                        <ComboBoxItem Content="Месяц"/>
                                    </ComboBox>
                                    <Button x:Name="StatisticsRefreshButton" 
                                            Grid.Column="1" 
                                            Content="Обновить" 
                                            Click="RefreshButton_Click" 
                                            Style="{StaticResource ActionButtonStyle}"/>
                                </Grid>
                            </Border>
                            <!-- Статистика -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="0" Background="#FF2E2E2E" CornerRadius="10" Margin="0,0,5,0" Padding="20">
                                    <StackPanel>
                                        <TextBlock Text="Общая статистика" FontSize="18" FontWeight="Bold" Foreground="#FFE0E0E0" Margin="0,0,0,10"/>
                                        <TextBlock Text="{Binding TotalOrders, StringFormat=Заказов: {0}}" Style="{StaticResource OrderCardTextStyle}"/>
                                        <TextBlock Text="{Binding TotalRevenue, StringFormat=Доход: {0:F2} ₽}" Style="{StaticResource OrderCardTextStyle}"/>
                                        <TextBlock Text="{Binding ActiveDrivers, StringFormat=Активных водителей: {0}}" Style="{StaticResource OrderCardTextStyle}"/>
                                    </StackPanel>
                                </Border>
                                <Border Grid.Column="1" Background="#FF2E2E2E" CornerRadius="10" Margin="5,0,0,0" Padding="20">
                                    <StackPanel>
                                        <TextBlock Text="График заказов" FontSize="18" FontWeight="Bold" Foreground="#FFE0E0E0" Margin="0,0,0,10"/>
                                        <lvc:CartesianChart x:Name="OrdersChart" Height="200" Series="{Binding ChartSeries}"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>
        </Border>

        <!-- Snackbar -->
        <materialDesign:Snackbar x:Name="Snackbar" Grid.ColumnSpan="2" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,20"/>
    </Grid>
</Window>